<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Planner</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header class="navbar">
    <div class="logo">ONWARD</div>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="maps.html">Maps</a>
      <a href="#">Community</a>
    </nav>
  </header>

  <main class="planner-layout">

    <!-- Sidebar -->
    <aside class="planner-sidebar">
      <h2>Team Management</h2>

      <div class="team-section">
        <h3>Blue Team</h3>
        <p>Blue 1, Blue 2</p>
      </div>

      <div class="team-section">
        <h3>Red Team</h3>
        <p>Red 1, Red 2</p>
      </div>

      <div class="team-section">
        <h3>Objectives</h3>
        <p>No objectives placed</p>
      </div>

      <!-- ROLE SELECTOR -->
      <div class="team-section">
        <h3>Role</h3>
        <div class="role-buttons">
          <button class="role-btn" data-role="rifleman">ğŸ”« Rifleman</button>
          <button class="role-btn" data-role="specialist">âš™ï¸ Specialist</button>
          <button class="role-btn" data-role="support">ğŸ“¦ Support</button>
          <button class="role-btn" data-role="marksman">ğŸ¯ Marksman</button>
        </div>
      </div>

    </aside>

    <!-- Main Map Area -->
    <section class="planner-map">
      <h1 id="map-title">Loading...</h1>
      <img id="map-image" src="" alt="Map Image">

      <!-- Player icons appear here -->
      <div id="player-layer"></div>
    </section>

  </main>

  <script>
    // Read ?map=bazaar from the URL
    const params = new URLSearchParams(window.location.search);
    const map = params.get("map");

    // Map data (with images)
    const mapInfo = {
      bazaar: { name: "Bazaar", image: "images/bazaar.jpg" },
      downfall: { name: "Downfall", image: "images/downfall.jpg" },
      quarantine: { name: "Quarantine", image: "images/quarantine.jpg" },
      subway: { name: "Subway", image: "images/subway_topdown.png" },
      suburbia: { name: "Suburbia", image: "images/suburbia.png" },
      tanker: { name: "Tanker", image: "images/tanker.jpg" }
    };

    // Update the page with map info
    if (mapInfo[map]) {
      document.getElementById("map-title").textContent = mapInfo[map].name;
      document.getElementById("map-image").src = mapInfo[map].image;
    } else {
      document.getElementById("map-title").textContent = "Unknown Map";
      document.getElementById("map-image").src = "";
    }

    // -------------------------------
    // PLAYER + ROLE SYSTEM
    // -------------------------------

    // Player data
    let players = {
      blue1: { x: 200, y: 200, team: "blue", role: "rifleman" },
      blue2: { x: 260, y: 200, team: "blue", role: "rifleman" },
      red1:  { x: 200, y: 300, team: "red", role: "rifleman" },
      red2:  { x: 260, y: 300, team: "red", role: "rifleman" }
    };

    // Objective icons
    let objectives = {
      uplink: { x: 400, y: 250, type: "uplink" },
      obj1:   { x: 500, y: 300, type: "objective" }
    };

    let selectedPlayer = null;

    // Render players on the map
    function renderPlayers() {
      const layer = document.getElementById("player-layer");
      layer.innerHTML = "";

      for (const id in players) {
        const p = players[id];

        const icon = document.createElement("div");
        icon.className = `player-icon player-${p.team}`;
        icon.textContent = id.toUpperCase();
        icon.style.left = p.x + "px";
        icon.style.top = p.y + "px";

        if (selectedPlayer === id) {
          icon.classList.add("selected-player");
        }

        icon.addEventListener("mousedown", (e) => {
          selectPlayer(id);
          startDrag(e, id);
        });

        layer.appendChild(icon);
      }
    }

    // Select a player
    function selectPlayer(id) {
      selectedPlayer = id;

      document.querySelectorAll(".role-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.role === players[id].role);
      });

      renderAll();
    }

    // Render objectives
    function renderObjectives() {
      const layer = document.getElementById("player-layer");

      for (const id in objectives) {
        const o = objectives[id];

        const icon = document.createElement("div");
        icon.className = `objective-icon ${o.type}`;
        icon.textContent = o.type === "uplink" ? "ğŸ“¡" : "ğŸ¯";
        icon.style.left = o.x + "px";
        icon.style.top = o.y + "px";

        icon.addEventListener("mousedown", (e) => startObjectiveDrag(e, id));

        layer.appendChild(icon);
      }
    }

    // Dragging logic
    let dragging = null;
    let offsetX = 0;
    let offsetY = 0;

    function startDrag(e, id) {
      dragging = id;
      offsetX = e.clientX - players[id].x;
      offsetY = e.clientY - players[id].y;

      document.addEventListener("mousemove", dragMove);
      document.addEventListener("mouseup", stopDrag);
    }

    function dragMove(e) {
      if (!dragging) return;

      players[dragging].x = e.clientX - offsetX;
      players[dragging].y = e.clientY - offsetY;

      renderAll();
    }

    function stopDrag() {
      dragging = null;
      document.removeEventListener("mousemove", dragMove);
      document.removeEventListener("mouseup", stopDrag);
    }

    // Objective dragging
    let draggingObjective = null;

    function startObjectiveDrag(e, id) {
      draggingObjective = id;
      offsetX = e.clientX - objectives[id].x;
      offsetY = e.clientY - objectives[id].y;

      document.addEventListener("mousemove", dragObjectiveMove);
      document.addEventListener("mouseup", stopObjectiveDrag);
    }

    function dragObjectiveMove(e) {
      if (!draggingObjective) return;

      objectives[draggingObjective].x = e.clientX - offsetX;
      objectives[draggingObjective].y = e.clientY - offsetY;

      renderAll();
    }

    function stopObjectiveDrag() {
      draggingObjective = null;
      document.removeEventListener("mousemove", dragObjectiveMove);
      document.removeEventListener("mouseup", stopObjectiveDrag);
    }

    // Role button click
    document.querySelectorAll(".role-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        if (!selectedPlayer) return;

        players[selectedPlayer].role = btn.dataset.role;

        document.querySelectorAll(".role-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        renderAll();
      });
    });

    // Render everything
    function renderAll() {
      renderPlayers();
      renderObjectives();
    }

    renderAll();
  </script>

</body>
</html>
